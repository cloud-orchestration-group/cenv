

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Developing module functionality &mdash; Zimagi 0.5.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/override.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #021026" >
          
            
          <div class="logo"><span class="sr-only">Zimagi</span></div>

          

          

          
          <a href="../readme.html" class="icon icon-home"><span class="name">Zimagi</span>
          
          </a>
          <span class="description">Distributed Data Processing Platform
            
              
              
              <span class="version">
                (0.5.1)
              </span>
              
            
          </span>


          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://zimagi.com">Zimagi Site</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/zimagi/zimagi/">GitHub Project</a></li>
</ul>
<p><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/readme.html">Getting Started with Zimagi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/use_module.html">Using Zimagi Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/use_module.html#installing-zimagi">Installing Zimagi</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/use_module.html#cloning-the-zimagi-repo">Cloning the Zimagi Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/use_module.html#configuring-the-environment">Configuring the environment</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/commands.html">The Command Line Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#config-commands">Config Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#environment-commands">Environment Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#database-commands">Database Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#schedule-commands">Schedule Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#data-import-commands">Data Import Commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/commands.html#user">User</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/vagrant.html">Launching Vagrant containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/vagrant.html#when-things-go-wrong">When things go wrong</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#dependencies">Dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#ports">Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/vagrant.html#recovery">Recovery</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../readme.html"><span>Zimagi</span> - <span class="description">Distributed Data Processing Platform</span></a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../readme.html">Docs</a> &raquo;</li>
        
      <li>Developing module functionality</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/creating_a_zimagi_module/module_functionality.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="developing-module-functionality">
<h1>Developing module functionality<a class="headerlink" href="#developing-module-functionality" title="Permalink to this headline">¶</a></h1>
<p>The Zimagi system will scan a number of YAML configuration files to provide
capabilities within a module.  Most of the requirements are driven by the various
keys inside these YAML files, but an organization into directories and filenames
is helpful for identifying the location of various definitions.</p>
<p>Configurations will live inside the <code class="docutils literal notranslate"><span class="pre">spec/</span></code> directory of the module repository.</p>
<section id="defining-roles">
<h2>Defining roles<a class="headerlink" href="#defining-roles" title="Permalink to this headline">¶</a></h2>
<p>We would like to define roles for differing kinds of users who have different
capabilities within the system.  Those are ideally placed in <code class="docutils literal notranslate"><span class="pre">spec/roles.yml</span></code>,
for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">noaa</span><span class="o">-</span><span class="n">stations</span><span class="p">)</span> <span class="n">cat</span> <span class="n">spec</span><span class="o">/</span><span class="n">roles</span><span class="o">.</span><span class="n">yml</span>
<span class="n">roles</span><span class="p">:</span>
  <span class="n">noaa</span><span class="o">-</span><span class="n">admin</span><span class="p">:</span> <span class="n">Administer</span> <span class="n">NOAA</span> <span class="n">weather</span> <span class="n">data</span>
  <span class="n">viewer</span><span class="p">:</span> <span class="n">User</span> <span class="n">who</span> <span class="n">can</span> <span class="n">view</span> <span class="n">weather</span> <span class="n">data</span>
</pre></div>
</div>
<p>We will use these roles later on to control what actions given named roles may
perform.  As many roles as we like may be defined, and they may be named however
we like.  However, using names with dashes or underscores are generally easier
to enter into other configuration files since quoting is not needed when spaces
are not used.</p>
</section>
<section id="data-mixins">
<h2>Data mixins<a class="headerlink" href="#data-mixins" title="Permalink to this headline">¶</a></h2>
<p>Zimagi allows you to configure “mixins” which are a kind of boilerplate that
avoids repeating the same definitions that are used in multiple places.  Mixins
might either be <code class="docutils literal notranslate"><span class="pre">data_mixins</span></code> or <code class="docutils literal notranslate"><span class="pre">command_mixins</span></code>.  We can define a
<code class="docutils literal notranslate"><span class="pre">data_mixin</span></code> in a fashion similar to this.  The same name (in this case
“station”) is used at several levels, but with somewhat different meanings in
the different positions.  Let us look at an example defined within
<code class="docutils literal notranslate"><span class="pre">spec/data/station.yml</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_mixins</span><span class="p">:</span>
  <span class="n">station</span><span class="p">:</span>
    <span class="n">class</span><span class="p">:</span> <span class="n">StationMixin</span>
    <span class="n">fields</span><span class="p">:</span>
      <span class="n">station</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="s2">&quot;@django.ForeignKey&quot;</span>
        <span class="n">relation</span><span class="p">:</span> <span class="n">station</span>
        <span class="n">options</span><span class="p">:</span>
          <span class="s2">&quot;null&quot;</span><span class="p">:</span> <span class="n">true</span>
          <span class="n">on_delete</span><span class="p">:</span> <span class="s2">&quot;@django.PROTECT&quot;</span>
          <span class="n">editable</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>In essence, what we define in the mixin is a database column that has attributes,
but is used in multiple places to define a foreign key relation.  The Django data
type identifies the relationship, with YAML keys <code class="docutils literal notranslate"><span class="pre">type</span></code> and <code class="docutils literal notranslate"><span class="pre">relation</span></code>
indicating the primary table.  The <code class="docutils literal notranslate"><span class="pre">options</span></code> values correspond to database
table properties in a straightforward way.</p>
<p>The initial mention of <code class="docutils literal notranslate"><span class="pre">station</span></code> is the name of our database column, and
below it we define the class and the fields that class contains, the primary
field being a different use of <code class="docutils literal notranslate"><span class="pre">station</span></code>.</p>
<p>Explicitly specifying a <code class="docutils literal notranslate"><span class="pre">class</span></code> name, as is done above, is optional (and is
not used for any real externally-facing purposes, only in code generation).
Mixins may also have inheritance relationships by specifying a <code class="docutils literal notranslate"><span class="pre">base</span></code>, but that
is not used in this example.</p>
</section>
<section id="command-mixins">
<h2>Command mixins<a class="headerlink" href="#command-mixins" title="Permalink to this headline">¶</a></h2>
<p>Commands, which we look at below, may also utilize mixins to save repeated
boilerplate.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command_mixins</span><span class="p">:</span>
  <span class="c1"># Generate methods on other classes</span>
  <span class="n">station</span><span class="p">:</span>
    <span class="n">class</span><span class="p">:</span> <span class="n">StationCommandMixin</span>
    <span class="n">meta</span><span class="p">:</span>
      <span class="c1"># Name used in commands (not required to be same as table)</span>
      <span class="c1"># Ref: mixin_name</span>
      <span class="n">station</span><span class="p">:</span>
        <span class="c1"># Link back to dynamic class station</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">station</span>
        <span class="c1"># Positive integer (lowest is highest priority)</span>
        <span class="n">priority</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Again we define a name <code class="docutils literal notranslate"><span class="pre">station</span></code> that might be mixed into. <code class="docutils literal notranslate"><span class="pre">class</span></code> remains
optional and generally internal.  The key elements is the a data source.  The
<code class="docutils literal notranslate"><span class="pre">priority</span></code> given simply expresses the order in which help on commands is shown.</p>
<p>The initial mention of <code class="docutils literal notranslate"><span class="pre">station</span></code> is the column in our database that we want
to reference. The second use of <code class="docutils literal notranslate"><span class="pre">station</span></code> indicates a meta attribute we want
to create. The key elements for this attribute are data and priority, with data
referencing the data source (<code class="docutils literal notranslate"><span class="pre">station</span></code>) and priority expressing the order in
which commands are shown when <code class="docutils literal notranslate"><span class="pre">help</span></code> is called.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Zimagi

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>