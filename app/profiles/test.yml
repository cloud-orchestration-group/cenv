
config:
    command_profiles:
        host:
            command_base: host
            resource: true
            remove_count: 2
        group:
            command_base: group
            resource: true
            remove_count: 2
        task:
        cache:

profile:
    "test_<<dict_key>>":
        _foreach: "#[process_profiles]filter(@command_profiles, resource = false)"
        _profile: "test/<<dict_key>>"
        ignore_missing: true

    "test_data_<<dict_key>>":
        _foreach: "#[resource_profiles]filter(@command_profiles, resource = true)"
        _profile: "test/<<dict_key>>"
        ignore_missing: true
        command_base: "<<command_base>>"
        data_type: "<<dict_key>>"

    "remove_<<dict_key>>":
        _requires:
            - "#prefix(@process_profiles, test_)"
            - "#prefix(@resource_profiles, test_data_)"
        _foreach: "@resource_profiles"
        _profile: test/data/remove
        _operations: destroy
        data_type: "<<dict_key>>"
        command_base: "<<command_base>>"
        remove_count: "<<remove_count>>"

    test_logs:
        _requires: "#prefix(@resource_profiles, remove_)"
        _profile: test/log
