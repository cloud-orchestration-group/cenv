#
# Define collections of fields for data models
#
data_mixins:
    <{ name }>:
        class: <{ class_name(name) }>Mixin
        fields:
            <{ name }>:
                type: "@django.ForeignKey"
                relation: <{ name }>
                options:
                    "null": true
                    on_delete: "@django.PROTECT"
                    editable: false

    <{ name }><{ plural_suffix }>:
        class: <{ class_name(name) }>MultipleMixin
        fields:
            <{ name }><{ plural_suffix }>:
                type: "@django.ManyToManyField"
                relation: <{ name }>

#
# Define abstract base data model (for parent relationships)
#
data_base:
    <{ name }>:
        class: <{ class_name(name) }>Base
        base: id_resource
        mixins: [<{ name }>]
        id_fields: [<{ name }>_id, name]
        meta:
            unique_together: [<{ name }>, name]
            scope: <{ name }>

#
# Define actual data model
#
data:
    <{ name }>:
        class: <{ class_name(name) }>
#%- if extend %#
        extend: <{ base }>
#%- else %#
        base: <{ base }>
#%- endif %#
#%- if id %#
        id: <{ id }>
#%- endif %#
#%- if id_fields %#
        id_fields: <{ id_fields }>
#%- endif %#
#%- if key %#
        key: <{ key }>
#%- endif %#
        roles:
            edit: <{ admin_roles }>
            view: <{ view_roles }>
        fields:
#%- if not name_field %#
            name: null
#%- endif %#
        meta:
#%- if extend %#
            unique_together: []
#%- elif unique_fields %#
            unique_together: <{ ensure_list(unique_fields) }>
#%- elif id_fields %#
            unique_together: <{ ensure_list(id_fields) }>
#%- endif %#
#%- if default_ordering %#
            ordering: <{ ensure_list(default_ordering) }>
#%- endif %#
#%- if command_base %#
            command_base: <{ command_base }>
#%- endif %#

#
# Define data related command mixin with autogenerated field and method accessors
#
command_mixins:
    <{ name }>:
        class: <{ class_name(name) }>Mixin
#%- if command_mixins %#
        mixins: <{ command_mixins }>
#%- endif %#
        meta:
            <{ name }>:
                data: <{ name }>
                priority: <{ mixin_priority }>

#
# Define data related base command
#
command_base:
    <{ name }>:
        mixins: [<{ name }>]
        server_enabled: <{ server_enabled }>
        groups_allowed: <{ admin_roles }>

#
# Define data resource commands (list, get, save, remove, clear)
#
command:
#%- if not command_base %#
#%- set command_base = name %#
#%- endif %#
#%- for element in split_text(command_base, '\s+') %#
<{ element | indent(width = (loop.index * 4), first = true) }>:
#%- if loop.last %#
#%- set indent_space = ((loop.index + 1) * 4) %#
<{ '' | indent(width = indent_space, first = true) }>resource: <{ name }>
<{ '' | indent(width = indent_space, first = true) }>base: <{ name }>
<{ '' | indent(width = indent_space, first = true) }>base_name: <{ name }>
<{ '' | indent(width = indent_space, first = true) }>priority: <{ resource_priority }>
#%- endif %#
#%- endfor %#
